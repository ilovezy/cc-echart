function getUrlParam(e){var a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),t=window.location.search.substr(1).match(a);return null!=t?unescape(t[2]):null}function getCompanyInfoAndCalculate(e,a){$.ajax({url:"../accounting_platedata.c?Data=Company&Tcode="+e,dataType:"jsonp",async:!1,cache:!1,jsonpCallback:"jsonpcallback"}).done(function(e){if(e.AR_COMPANY[0])if(t=e.AR_COMPANY[0],$("#EPS").text((+t.LR15).toFixed(3)+" 元"),$("#BookVal").text((+t.ZC23).toFixed(3)+" 元"),$("#SalesPerShare").text((+t.LR01).toFixed(3)+" 元"),$("#FullName").text(t.FullName),$("#AreaName").text(t.Area_Name),$("#DetailTrade").text(t.DetailTrade),""!==a&&$.isNumeric(+a)){a=+a;var t=e.AR_COMPANY[0],o=+t.LR15;0>=o&&$.isNumeric(a)?$("#PERatio").text("--"):$("#PERatio").text((a/o).toFixed(2));var n=+t.ZC23;0>=n&&$.isNumeric(a)?$("#PBRatio").text("--"):$("#PBRatio").text((a/n).toFixed(2));var s=+t.LR01;0>=s&&$.isNumeric(a)?$("#PriceToSalesRatio").text("--"):$("#PriceToSalesRatio").text((a/s).toFixed(2)),t.FreeStock&&$.isNumeric(a)?$("#CirculationMarketValue").text((a*+t.FreeStock/1e4).toFixed(2)+" 亿元"):$("#CirculationMarketValue").text("--"),t.TotalStock&&$.isNumeric(a)?$("#TotalStock").text((a*+t.TotalStock/1e4).toFixed(2)+" 亿元"):$("#TotalStock").text("--"),$("#showBackTable").removeClass("hide")}else $("#PERatio, #PBRatio, #PriceToSalesRatio,#CirculationMarketValue,#TotalStock").text("--");else $("#EPS,#BookVal,#SalesPerShare,#FullName,#AreaName,#DetailTrade, #PERatio, #PBRatio, #PriceToSalesRatio,#CirculationMarketValue, #TotalStock").text("--")}),getStockPlateAndShow(e)}function getStockPlateAndShow(e){function a(e){$("#StockPlateTable").html(e),$("#StockPlateData").removeClass("hide")}$.ajax({url:"../accounting_platedata.c?Data=CompanyIndex&Tcode="+e,dataType:"jsonp",async:!1,cache:!1,jsonpCallback:"jsonpcallback"}).done(function(e){if(e.Index){var t=e.Index,o="";$.each(t,function(e,a){var t=a.Code.toString()+"（"+a.Name+"）";o+='<div class="col-md-4" style="height: 36px;line-height: 36px; border-left: 0; border-bottom: 1px solid white; text-align: left; padding-left: 5em;">'+t+"</div>"}),a(o)}else a("<div>--</div>")}).fail(function(){a("<div>--</div>")}),$("#StockPlateData").removeClass("hide")}function getBackDataRunGetSina(e){var a=!1;$.ajax({url:"../query_FetchDataKData.c?Tcode="+e,dataType:"jsonp",async:!1,cache:!1,jsonpCallback:"jsonpcallback"}).done(function(t){if(t){$("#stockName").text(t.AR_COMPANY[0].Tname),$("#stockId").text(e);var o=t.AR_FETCH_DATA||[],n=[],s=[];if($.each(o,function(e,a){var t={},o=a.ReportDate,r=o.substring(0,4);t.ReportDate=o,t.year=r,t.month=o.substring(4),t.PerShare=a.PerShare,n.push(t),0==s.length?s.push(r):$.inArray(r,s)>-1||s.push(r)}),s.length>0){for(var r=[],i=0;i<s.length;i++)for(var l=3,c=0;4>c;c++)3>c?r.push(""+s[i]+"0"+l):r.push(""+s[i]+l),l+=3;$.each(n,function(e,a){var t=$.inArray(a.ReportDate,r);t>-1&&(r[t]=a.PerShare)}),$.each(r,function(e,a){a>1e3&&(r[e]="")});for(var d=[],i=0,h=0,u=[];i<r.length;i++)3>h?(u.push(r[i]),h++):(u.push(r[i]),d.push(u),h=0,u=[]);for(var i=0;i<d.length;i++)d[i].unshift(s[i]);var p=[];calculateUpRate(p,d),concatStrAndFillTable(d,p,$("#mainSingleTable tbody")),$.ajax({url:"../query_FetchDataKData.c?Tcode="+e+"&DataType=1",dataType:"jsonp",async:!1,cache:!1,jsonpCallback:"jsonpcallback"}).done(function(e){if(e.AR_FETCH_DATA){var a=e.AR_FETCH_DATA||[],t=[],o=[];$.each(a,function(e,a){var n={},s=a.ReportDate,r=s.substring(0,4);n.ReportDate=s,n.year=r,n.month=s.substring(4),n.PerShare=a.PerShare,t.push(n),0==o.length?o.push(r):$.inArray(r,o)>-1||o.push(r)});for(var a=e.AR_FETCH_DATA,n=[],s=0;s<o.length;s++)for(var r=3,i=0;4>i;i++)3>i?n.push(""+o[s]+"0"+r):n.push(""+o[s]+r),r+=3;$.each(t,function(e,a){var t=$.inArray(a.ReportDate,n);t>-1&&(n[t]=a.PerShare)}),$.each(n,function(e,a){a>1e3&&(n[e]="")});for(var l=[],s=0,c=0,d=[];s<n.length;s++)3>c?(d.push(n[s]),c++):(d.push(n[s]),l.push(d),c=0,d=[]);for(var s=0;s<l.length;s++)l[s].unshift(o[s]);var h=[];calculateUpRate(h,l),concatStrAndFillTable(l,h,$("#mainCountTable tbody"))}}),$("#showPershareTable, #showBackTable").removeClass("hide"),a=!0,getSinaDataAndShowK(e)}else cleanPershareTable(),showErrorMessage("没有找到该公司数据")}else cleanPershareTable(),showErrorMessage("没有找到该公司数据")}).fail(function(){cleanPershareTable(),showErrorMessage("没有找到该公司数据")})}function getSinaDataAndShowK(e){var a="";a="6"==e.charAt(0)?"sh"+e:"sz"+e,$.ajax({cache:!0,url:"http://hq.sinajs.cn/list="+a,type:"GET",async:!1,dataType:"script"}).done(function(){var t="hq_str_"+a;if(window[t]||""!==window[t]){var o=window[t].split(",");if($("#sinaData").removeClass("hide"),$("#sina-K-show").removeClass("hide"),$("#stockName").text(o[0]),$("#stockId").text(e),0!=o[1]&&""!=o[1]&&o[1]){$("#todayOpen").text(o[1]);var n=(o[3]-o[2]).toFixed(2),s=(n/o[2]*100).toFixed(2)+"%";o[3]>=o[2]?$("#nowPrice").removeClass().addClass("text-danger").html(o[3]+'<span class="glyphicon glyphicon-arrow-up" style="font-size: 28px"></span><span style="overflow: hidden;font-size: 11px"><span style="position: absolute; top: -8px; padding-left: 3px"> +'+n+'</span><span style=""> +'+s+"</span>"):$("#nowPrice").removeClass().addClass("text-success").html(o[3]+'<span class="glyphicon glyphicon-arrow-down" style="font-size: 28px"></span><span style="overflow: hidden; font-size: 11px"><span style="position: absolute; top: -8px; padding-left: 3px">'+n+'</span><span"> '+s+"</span>");var r=o[3]}else $("#todayOpen").text("--"),0!=o[2]&&""!=o[2]&&o[2]?$("#nowPrice").removeClass("text-danger").text(o[2]):$("#nowPrice").addClass("text-danger").text("停牌");0!=o[2]&&""!=o[2]&&o[2]?$("#yestodayClose").text(o[2]):$("#yestodayClose").text("--"),0!=o[4]&&""!=o[4]&&o[4]?$("#highestPrice").text(o[4]):$("#highestPrice").text("--"),0!=o[5]&&""!=o[5]&&o[5]?$("#lowestPrice").text(o[5]):$("#lowestPrice").text("--"),0!=o[8]&&""!=o[8]&&o[8]?$("#volume").text((o[8]/1e6).toFixed(2)+" 万手"):$("#volume").text("--"),0!=o[9]&&""!=o[9]&&o[9]?$("#amount").text((o[9]/1e8).toFixed(2)+" 亿元"):$("#amount").text("--"),window[t]="";var i='<object type="application/x-shockwave-flash" data="http://finance.sina.com.cn/flash/cn.swf?" width="920" height="920" id="flash" style="visibility: visible;"><param name="allowFullScreen" value="true"><param name="allowScriptAccess" value="always"><param name="wmode" value="transparent"><param name="flashvars" value="symbol='+a+'&amp;code=iddg64geja6fea4eafh9jbj7c5j4ie5d&amp;s=3"></object>';$("#sina-K-show").html(i).removeClass("hide"),r&&""!==r?getCompanyInfoAndCalculate(e,r):o[2]&&""!==o[2]?getCompanyInfoAndCalculate(e,o[2]):getCompanyInfoAndCalculate(e,""),$("#showBackTable").removeClass("hide"),$("#showPershareTable, #sina-K-show").removeClass("hide")}})}function showErrorMessage(e){$("#showErrorMessage").removeClass("hide").find("div").text(e)}function cleanPershareTable(){$("#mainSingleTable tbody, #mainCountTable tbody").empty()}function calculateUpRate(e,a){$.each(a,function(t,o){var n=[];n[0]=o[0],$.each(o,function(e,o){if(e>0)if(o=+o,""!==o&&0!==o&&a[t+1]&&""!==a[t+1][e]&&0!==+a[t+1][e]){var s=a[t+1][e];if(0>=s)n.push("");else{var r=((o-s)/s*100).toFixed(1);n.push(r)}}else n.push("")}),e.push(n)})}function concatStrAndFillTable(e,a,t){var o="";$.each(e,function(e,t){var n="",s=a[e];$.each(t,function(e,a){if(0==e)n+="<td>"+a+"</td>";else if(""!==a)if(""!=s[e]){var t=+s[e],a=(+a).toFixed(3);n+=""!==t&&t>=0?"<td>"+a+'</td><td class="text-danger"><i>'+t+"%</i></td>":""!==t&&0>t?"<td>"+a+'</td><td class="text-success"><i>'+t+"%</i></td>":"<td>"+a+"</td><td></td>"}else n+="<td>"+a+"</td><td></td>";else n+="<td></td><td></td>"}),o+="<tr>"+n+"</tr>"}),t.empty().html(o)}var url=window.location.href,TcodeVal=getUrlParam("Tcode");TcodeVal&&($("#sidebarLinks").find("a").each(function(e,a){var t=$(this).attr("href");URI(t).search()&&(t=URI(t).removeSearch("Tcode"));var o=t+"?Tcode="+TcodeVal;$(this).attr("href",o)}),$("#Tcode").val(TcodeVal),getBackDataRunGetSina(TcodeVal)),$("#Tcode").on("change",function(){var e=$(this).val();$("#sidebarLinks").find("a").each(function(a,t){var o=$(this).attr("href"),n=URI(o).removeSearch("Tcode").addSearch("Tcode",e);$(this).attr("href",n)})}),$("#searchData").on("submit",function(e){e.preventDefault(),$("#btn-companyInfo-search").trigger("click")}),$(window).on("load",function(){$("input#Tcode").focus()}),$("#btn-companyInfo-search").click(function(){var e=$("#Tcode").val();$("#EPS,#BookVal,#SalesPerShare,#FullName,#AreaName,#DetailTrade, #PERatio, #PBRatio, #PriceToSalesRatio,#CirculationMarketValue, #TotalStock").text("--"),$("#sinaData, #showPershareTable, #StockPlateData, #showBackTable, #sina-K-show").addClass("hide"),cleanPershareTable(),0==e.length?showErrorMessage("股票id长度不能为0"):6!==e.length?showErrorMessage("股票id长度不等于6了"):($("#showErrorMessage").addClass("hide"),getBackDataRunGetSina(e))});
//# sourceMappingURL=companyInfo-base.min.js.map